<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ¨çº¿ Markdown ç¼–è¾‘å™¨ - Kayler</title>
    <link rel="icon" href="/favicon.png" type="image/png">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="editor.css">

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <script src="layout.js?v=6.0"></script>
</head>
<body>

    <div class="main-wrapper">
        <div class="editor-toolbar-header">
            <div class="page-title">
                <i class="fa-solid fa-pen-nib" style="color: #666;"></i>
                <input type="text" id="file-name-input" class="title-input" value="æ–°æ–‡æ¡£.md" placeholder="æ–‡ä»¶å (ä¾‹å¦‚: doc.md)">
            </div>
            
            <div class="action-group">
                <button id="btn-setting" class="btn btn-setting" title="GitHub é…ç½®">
                    <i class="fa-solid fa-gear"></i>
                </button>
                
                <button id="btn-save" class="btn btn-save" disabled title="éœ€åœ¨è®¾ç½®ä¸­é…ç½® Token">
                    <i class="fa-solid fa-cloud-arrow-up"></i> å‘å¸ƒ
                </button>
                
                <button id="btn-pdf" class="btn btn-pdf" title="å¯¼å‡ºä¸º PDF">
                    <i class="fa-solid fa-file-pdf"></i> PDF
                </button>
                
                <button id="btn-md" class="btn btn-md" title="ä¸‹è½½ .md æ–‡ä»¶">
                    <i class="fa-solid fa-download"></i> .md
                </button>
                
                <button id="btn-long-img" class="btn btn-long" title="ç”Ÿæˆåˆ†äº«é•¿å›¾">
                    <i class="fa-solid fa-image"></i> è½¬é•¿å›¾
                </button>
            </div>
        </div>

        <div class="editor-container">
            <div class="panel">
                <div class="panel-header">
                    <span><i class="fa-brands fa-markdown"></i> Markdown æºç </span>
                    <span id="btn-copy-code" class="copy-btn">å¤åˆ¶æºç </span>
                </div>
                <textarea id="editor" class="editor-area" placeholder="# å¼€å§‹å†™ä½œ...&#10;&#10;æ”¯æŒ Markdown è¯­æ³•ï¼Œå®æ—¶é¢„è§ˆã€‚"></textarea>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <span><i class="fa-solid fa-eye"></i> å®æ—¶é¢„è§ˆ</span>
                    <span id="btn-copy-text" class="copy-btn">å¤åˆ¶æ–‡æœ¬</span>
                </div>
                <div id="preview" class="preview-area markdown-body"></div>
            </div>
        </div>
    </div>

    <script src="editor.js?v=6.2"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // è°ƒç”¨ editor.js ä¸­çš„åˆå§‹åŒ–å‡½æ•°ï¼Œç»‘å®šæŒ‰é’®äº‹ä»¶
            if (window.initEditor) {
                window.initEditor();
            }

            // === å…³é”®ï¼šä¿ç•™æ—§ç‰ˆçš„æ•°æ®æ¢å¤é€»è¾‘ ===
            // æ£€æŸ¥ LocalStorage æ˜¯å¦æœ‰ç¼“å­˜ï¼Œæˆ–è€…æ˜¯å¦æœ‰ä» PromptMaster å¯¼å…¥çš„æ–‡ä»¶
            const editorEl = document.getElementById('editor');
            const nameEl = document.getElementById('file-name-input');
            const importedContent = localStorage.getItem('kayler_editor_cache');
            const importedName = localStorage.getItem('kayler_editor_filename');
            
            if (editorEl) {
                if (importedName) {
                    // æƒ…å†µ A: ä» PromptMaster å¯¼å…¥ (ä¼˜å…ˆçº§æœ€é«˜)
                    editorEl.value = importedContent || "";
                    if (nameEl) nameEl.value = importedName;
                    
                    // å¯¼å…¥åæ¸…é™¤æ–‡ä»¶åæ ‡è®°ï¼Œé˜²æ­¢ä¸‹æ¬¡åˆ·æ–°è¿˜æ˜¯è¿™ä¸ªæ–‡ä»¶
                    localStorage.removeItem('kayler_editor_filename'); 
                    console.log("ğŸ“‚ å·²åŠ è½½å¯¼å…¥çš„æ–‡ä»¶:", importedName);
                } else if (importedContent) {
                    // æƒ…å†µ B: æ™®é€šç¼“å­˜æ¢å¤
                    editorEl.value = importedContent;
                } else {
                    // æƒ…å†µ C: é»˜è®¤æ¬¢è¿è¯­
                    editorEl.value = "# æ¬¢è¿ä½¿ç”¨ Kayler ç¼–è¾‘å™¨\n\nè¯·åœ¨ä¸Šæ–¹ä¿®æ”¹æ–‡ä»¶åï¼Œå¹¶åœ¨è®¾ç½®ä¸­é…ç½® Token ä»¥å¯ç”¨å‘å¸ƒåŠŸèƒ½ã€‚";
                }

                // è§¦å‘ä¸€æ¬¡é¢„è§ˆæ›´æ–° (è°ƒç”¨ editor.js æš´éœ²çš„æ–¹æ³•)
                if (window.updatePreview) {
                    window.updatePreview();
                } else {
                    // å…œåº•ï¼šå¦‚æœ JS åŠ è½½æ…¢äº†ï¼Œæ‰‹åŠ¨è§¦å‘ input äº‹ä»¶
                    editorEl.dispatchEvent(new Event('input'));
                }
            }
        });
    </script>
</body>
</html>