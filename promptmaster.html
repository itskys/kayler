<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta property="og:image" content="https://x.aisai.cc/social-cover.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æç¤ºè¯ç®¡ç†å™¨ - Kayler</title>
    <link rel="icon" href="/favicon.png" type="image/png">
    
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <script src="layout.js?v=5.0"></script>
    
    <style>
        /* === å…¨å±€å˜é‡ === */
        :root {
            --bg-body: #f2f4f7; --text-color: #2c2c2c;
            --brand-brown: #8b5e3c; --brand-brown-hover: #6d4c41;
            --card-shadow: 0 4px 20px rgba(0,0,0,0.05);
            --layout-width: 94%; --layout-max-width: 1600px;
        }

        * { box-sizing: border-box; }

        body {
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif;
            background-color: var(--bg-body); margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh; color: var(--text-color);
        }

        /* é¡¶éƒ¨å¯¼èˆªç”± layout.js æ³¨å…¥ */

        header { text-align: center; margin-bottom: 40px; margin-top: 20px; }
        h1 { 
            font-size: 32px; font-weight: 800; color: #222; margin-bottom: 10px; 
            display: flex; align-items: center; justify-content: center;
        }
        
        /* === ä¸»å¸ƒå±€å®¹å™¨ === */
        .main-container {
            width: var(--layout-width); max-width: var(--layout-max-width);
            display: flex; flex-direction: column; gap: 40px;
            flex: 1; 
        }

        .section-title {
            font-size: 20px; font-weight: bold; color: #444; border-left: 5px solid var(--brand-brown);
            padding-left: 15px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;
        }
        .refresh-btn {
            font-size: 14px; color: var(--brand-brown); cursor: pointer; text-decoration: none; border: 1px solid var(--brand-brown);
            padding: 4px 10px; border-radius: 4px; transition: all 0.2s; background: transparent;
        }
        .refresh-btn:hover { background: var(--brand-brown); color: white; }

        /* === åŒºåŸŸ 1: æç¤ºè¯ç»„è£…å™¨ === */
        .builder-area {
            background: white; padding: 30px; border-radius: 16px;
            box-shadow: var(--card-shadow);
            display: flex; flex-direction: column; gap: 15px;
        }

        #promptInput {
            width: 100%; height: 150px; border: 1px solid #eee; border-radius: 8px;
            resize: vertical; outline: none; padding: 20px; 
            font-family: "Menlo", monospace; font-size: 14px; line-height: 1.6;
            background: #fafafa; color: #333;
        }
        #promptInput:focus { background: #fff; border-color: var(--brand-brown); }

        .builder-actions {
            display: flex; justify-content: space-between; align-items: center; margin-top: 10px;
        }
        .btn {
            padding: 8px 16px; border-radius: 6px; border: none; cursor: pointer;
            font-size: 13px; font-weight: bold; transition: all 0.2s; display: flex; align-items: center; gap: 6px;
        }
        .btn-primary { background: var(--brand-brown); color: white; }
        .btn-secondary { background: #f0f0f0; color: #666; }
        .btn-preview { background: #e3f2fd; color: #1565c0; } 
        
        .tags-container { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px; }
        .tag {
            background: white; padding: 6px 12px; border-radius: 50px;
            border: 1px solid #eee; color: #555; cursor: pointer;
            font-size: 12px; transition: all 0.2s; user-select: none;
        }
        .tag:hover {
            border-color: var(--brand-brown); color: var(--brand-brown);
            transform: translateY(-2px); box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        /* === åŒºåŸŸ 2: çŸ¥è¯†åº“åˆ—è¡¨ === */
        .list-container {
            background: white; border-radius: 16px;
            box-shadow: var(--card-shadow); overflow: hidden;
            padding: 0; min-height: 200px; position: relative;
        }

        table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        thead { background: #f9f7f1; }
        th, td { 
            padding: 18px 20px; text-align: left; 
            border-bottom: 1px solid #eee; font-size: 14px; 
            overflow: hidden; text-overflow: ellipsis; white-space: nowrap; 
        }
        
        th.sortable { cursor: pointer; user-select: none; transition: background 0.2s; }
        th.sortable:hover { background: #f0ebe4; }
        th.sortable::after { content: ' â†•'; font-size: 10px; color: #999; }
        th.sortable.asc::after { content: ' â†‘'; color: var(--brand-brown); opacity: 1; }
        th.sortable.desc::after { content: ' â†“'; color: var(--brand-brown); opacity: 1; }
        
        th { font-weight: bold; color: #8b5e3c; }
        tr:last-child td { border-bottom: none; }
        tr:hover { background-color: #fafafa; }

        .prompt-link {
            color: #2c2c2c; font-weight: 600; text-decoration: none;
            cursor: pointer; transition: color 0.2s; display: inline-flex; align-items: center; gap: 5px;
            border-bottom: 1px dashed #ccc;
        }
        .prompt-link:hover { color: var(--brand-brown); border-bottom-color: var(--brand-brown); }
        
        /* ç¤ºä¾‹é“¾æ¥æ ·å¼ */
        .example-tag {
            display: inline-flex; align-items: center; gap: 4px;
            background: #e3f2fd; color: #1565c0; 
            padding: 2px 8px; border-radius: 4px; font-size: 12px; 
            text-decoration: none; margin-right: 5px; cursor: pointer;
            transition: all 0.2s; border: 1px solid transparent;
        }
        .example-tag:hover { background: #bbdefb; border-color: #1565c0; }
        .example-tag i { font-style: normal; }

        .badge {
            display: inline-block; padding: 2px 8px; border-radius: 4px;
            font-size: 12px; font-weight: bold; background: #e0e0e0; color: #555;
        }
        .badge.v-new { background: #e8f5e9; color: #2e7d32; }

        .loading-state {
            display: flex; justify-content: center; align-items: center; height: 200px; color: #999; flex-direction: column; gap: 10px;
        }

        /* === æ–‡ä»¶/æ–‡æœ¬é¢„è§ˆå¼¹çª— === */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 2000;
            justify-content: center; align-items: center;
            backdrop-filter: blur(2px);
        }
        .modal-overlay.active { display: flex; }
        .modal-content {
            background: white; width: 90%; max-width: 900px; height: 85vh;
            border-radius: 12px; box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            display: flex; flex-direction: column; overflow: hidden;
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-header { padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; background: #fdfbf7; }
        .modal-title { font-size: 18px; font-weight: bold; color: #333; }
        .close-btn { background: none; border: none; font-size: 24px; cursor: pointer; color: #999; }
        
        .modal-body { flex: 1; padding: 30px; overflow-y: auto; background: #fff; }
        
        pre.raw-code { white-space: pre-wrap; word-wrap: break-word; font-family: "Menlo", "Monaco", monospace; font-size: 14px; color: #333; margin: 0; }
        .markdown-body h1 { border-bottom: 2px solid #eee; padding-bottom: 10px; font-size: 24px; }
        .markdown-body pre { background: #f5f5f5; padding: 15px; border-radius: 8px; overflow-x: auto; }
        
        .modal-footer { padding: 15px; border-top: 1px solid #eee; text-align: right; background: white; display: flex; justify-content: flex-end; gap: 10px; }
        
        /* å¯¼å…¥æŒ‰é’® */
        .btn-import { background: #2e7d32; color: white; display: none; } 
        .btn-import:hover { background: #1b5e20; }
        .btn-import:disabled { opacity: 0.5; cursor: not-allowed; }

        /* === åª’ä½“ç¯ç®± (Lightbox) === */
        #lightboxModal {
            display: none; position: fixed; z-index: 3000;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            justify-content: center; align-items: center;
            flex-direction: column;
        }
        #lightboxModal.active { display: flex; }
        #lightboxContent { max-width: 95%; max-height: 85vh; border-radius: 4px; box-shadow: 0 0 50px rgba(0,0,0,0.5); }
        .lightbox-close { position: absolute; top: 20px; right: 30px; font-size: 40px; color: white; cursor: pointer; transition: 0.2s; }
        .lightbox-close:hover { color: var(--brand-brown); }
        .lightbox-caption { color: #ccc; margin-top: 15px; font-size: 14px; font-family: sans-serif; }

        footer { margin-top: 60px; padding-top: 20px; border-top: 1px solid #eee; width: 100%; max-width: 1000px; text-align: center; color: #999; font-size: 13px; }
        .admin-link { color: #ddd; text-decoration: none; font-size: 12px; cursor: pointer; }
        .admin-link:hover { color: var(--brand-brown); text-decoration: underline; }

        /* === ğŸ“± ç§»åŠ¨ç«¯é€‚é… === */
        @media (max-width: 768px) {
            .builder-actions { flex-direction: column; gap: 10px; }
            .left-actions, .right-actions { width: 100%; justify-content: space-between; }
            th:nth-child(2), td:nth-child(2), /* ç‰ˆæœ¬ */
            th:nth-child(4), td:nth-child(4)  /* ä½œè€… */
            { display: none; }
            th:first-child, td:first-child { width: 40%; }
            th:nth-child(3), td:nth-child(3) { width: 30%; } /* æè¿° */
            
            .modal-content { width: 95%; height: 80vh; }
            .modal-footer { flex-direction: column; }
            .modal-footer .btn { width: 100%; }
        }
    </style>
</head>
<body>

    <header>
        <h1>
            <img src="/logo.png" alt="Logo" style="height: 36px; vertical-align: middle; margin-right: 8px;">
            æç¤ºè¯ç®¡ç†å™¨
        </h1>
        <p style="color:#888">æ’°å†™ã€ç»„è£…ã€ç®¡ç†æ‚¨çš„ AI æç¤ºè¯èµ„äº§</p>
    </header>

    <div class="main-container">
        
        <div class="builder-area">
            <textarea id="promptInput" placeholder="ç‚¹å‡»ä¸‹æ–¹æ ‡ç­¾æ·»åŠ ï¼Œæˆ–ç›´æ¥åœ¨æ­¤è¾“å…¥..."></textarea>
            
            <div class="tags-container">
                <div class="tag" onclick="addTag('Cyberpunk')">èµ›åšæœ‹å…‹</div>
                <div class="tag" onclick="addTag('Ukiyo-e style')">æµ®ä¸–ç»˜</div>
                <div class="tag" onclick="addTag('8k resolution')">8K åˆ†è¾¨ç‡</div>
                <div class="tag" onclick="addTag('--ar 16:9')">å®½å± 16:9</div>
                <div class="tag" onclick="addTag('--v 6.0')">MJ V6</div>
                <div class="tag" onclick="addTag('--niji 6')">Niji 6</div>
            </div>

            <div class="builder-actions">
                <button class="btn btn-secondary" onclick="clearPrompt()">ğŸ—‘ï¸ æ¸…ç©º</button>
                <button class="btn btn-preview" onclick="openPreview()">ğŸ‘ï¸ é¢„è§ˆæ¸²æŸ“</button>
                <button class="btn btn-primary" onclick="copyPrompt()">ğŸ“‹ ä¸€é”®å¤åˆ¶</button>
            </div>
        </div>

        <div>
            <div class="section-title">
                ğŸ“š æç¤ºè¯åº“ (è‡ªåŠ¨åŒæ­¥)
                <button class="refresh-btn" onclick="fetchRepoData()">ğŸ”„ åˆ·æ–°åˆ—è¡¨</button>
            </div>
            <div class="list-container">
                <div id="loadingState" class="loading-state">
                    <div style="font-size:24px;">â³</div>
                    <div>æ­£åœ¨è¯»å– GitHub åˆ—è¡¨...</div>
                </div>
                <table id="dataTable" style="display:none;">
                    <thead>
                        <tr>
                            <th style="width: 35%;" class="sortable" onclick="sortTable('name')" data-key="name">æç¤ºè¯åç§°</th>
                            <th style="width: 10%;" class="sortable" onclick="sortTable('version')" data-key="version">ç‰ˆæœ¬</th>
                            <th style="width: 25%;">åŠŸèƒ½æè¿°</th> <th style="width: 20%;">ç¤ºä¾‹å±•ç¤º</th> <th style="width: 10%;" class="sortable" onclick="sortTable('author')" data-key="author">ä½œè€…</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody"></tbody>
                </table>
            </div>
            <p style="text-align:center; color:#999; font-size:12px; margin-top:10px;">
                åˆ—è¡¨æ•°æ®å®æ—¶è¯»å–è‡ª GitHubã€‚ç‚¹å‡»è¡¨å¤´å¯æ’åºã€‚
            </p>
        </div>

    </div>

    <div style="text-align: center; margin-top: -20px; margin-bottom: 20px;">
        <a onclick="openGlobalSettings()" class="admin-link">âš™ï¸ ç®¡ç†å‘˜é…ç½®</a>
    </div>

    <div class="modal-overlay" id="modalOverlay" onclick="if(event.target===this) closeModal()">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">æ–‡ä»¶é¢„è§ˆ</div>
                <button class="close-btn" onclick="closeModal()">Ã—</button>
            </div>
            <div class="modal-body">
                <pre class="raw-code" id="fileContent">æ­£åœ¨åŠ è½½...</pre>
            </div>
            <div class="modal-footer">
                <button class="btn btn-import" id="btnImport" onclick="importToEditor()">âœï¸ å¯¼å…¥ç¼–è¾‘å™¨</button>
                <button class="btn btn-primary" onclick="copyContent()">ğŸ“‹ å¤åˆ¶å†…å®¹</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="previewModal" onclick="if(event.target===this) document.getElementById('previewModal').classList.remove('active')">
        <div class="modal-content">
             <div class="modal-header">
                <div class="modal-title">Markdown æ¸²æŸ“é¢„è§ˆ</div>
                <button class="close-btn" onclick="document.getElementById('previewModal').classList.remove('active')">Ã—</button>
            </div>
            <div class="modal-body markdown-body" id="previewBody"></div>
        </div>
    </div>

    <div id="lightboxModal" onclick="if(event.target===this) closeLightbox()">
        <span class="lightbox-close" onclick="closeLightbox()">&times;</span>
        <img id="lightboxContent" src="" style="display:none;">
        <video id="lightboxVideo" controls style="display:none; max-width:90%; max-height:85vh; box-shadow:0 0 30px black;"></video>
        <div class="lightbox-caption" id="lightboxCaption"></div>
    </div>

    <script>
        // === é…ç½® ===
        const REPO_CONFIG = { owner: 'itskys', repo: 'kayler', path: 'prompt', branch: 'main' };
        
        let globalFilesData = [];
        let currentSort = { key: 'name', order: 'desc' }; 
        let currentFileData = { name: '', content: '' }; 

        const promptInput = document.getElementById('promptInput');
        const tableBody = document.getElementById('tableBody');
        const loadingState = document.getElementById('loadingState');
        const dataTable = document.getElementById('dataTable');
        const modal = document.getElementById('modalOverlay');
        const modalTitle = document.getElementById('modalTitle');
        const fileContent = document.getElementById('fileContent');
        const btnImport = document.getElementById('btnImport');

        // === 1. æ’°å†™åŠ©æ‰‹ ===
        function addTag(text) {
            let current = promptInput.value;
            if (current.length > 0 && !current.endsWith(' ')) current += ' ';
            promptInput.value = current + text;
        }
        function clearPrompt() { if(confirm('ç¡®å®šæ¸…ç©ºï¼Ÿ')) promptInput.value = ''; }
        function copyPrompt() { navigator.clipboard.writeText(promptInput.value).then(() => alert('å·²å¤åˆ¶!')); }
        function openPreview() {
            const text = promptInput.value;
            if(!text.trim()) return;
            document.getElementById('previewBody').innerHTML = marked.parse(text);
            document.getElementById('previewModal').classList.add('active');
        }

        // === 2. åˆ—è¡¨è·å– (æ ¸å¿ƒå‡çº§ï¼šå¹¶å‘è·å–æç¤ºè¯å’Œç”»å»Š) ===
        async function fetchRepoData() {
            loadingState.style.display = 'flex'; dataTable.style.display = 'none'; tableBody.innerHTML = '';

            const owner = localStorage.getItem('gh_owner') || REPO_CONFIG.owner;
            const repo = localStorage.getItem('gh_repo') || REPO_CONFIG.repo;
            const token = localStorage.getItem('gh_token');
            const headers = token ? { 'Authorization': `token ${token}` } : {};

            try {
                // å¹¶å‘è¯·æ±‚ï¼šè·å–æç¤ºè¯åˆ—è¡¨ + è·å–ç”»å»Šåˆ—è¡¨
                const [promptRes, galleryRes] = await Promise.all([
                    fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${REPO_CONFIG.path}?ref=${REPO_CONFIG.branch}&t=${Date.now()}`, { headers }),
                    fetch(`https://api.github.com/repos/${owner}/${repo}/contents/gallery?ref=${REPO_CONFIG.branch}&t=${Date.now()}`, { headers }).catch(() => ({ ok: false })) // ç”»å»Šå¤±è´¥ä¸å½±å“ä¸»åˆ—è¡¨
                ]);

                if (!promptRes.ok) throw new Error("API Limit (Prompts)");
                const promptFiles = await promptRes.json();
                
                // å¤„ç†ç”»å»Šæ•°æ®
                let galleryFiles = [];
                if (galleryRes.ok) {
                    galleryFiles = await galleryRes.json();
                }

                // æ•°æ®æ•´åˆ
                globalFilesData = promptFiles
                    .filter(f => f.name.endsWith('.md') || f.name.endsWith('.txt'))
                    .map(file => {
                        const meta = parseFilename(file.name);
                        
                        // è‡ªåŠ¨å…³è”ï¼šåœ¨ç”»å»Šä¸­å¯»æ‰¾åŒ…å«æç¤ºè¯åç§°çš„æ–‡ä»¶
                        // è§„åˆ™ï¼šæ–‡ä»¶ååŒ…å«æç¤ºè¯å (å¿½ç•¥å¤§å°å†™)
                        const examples = galleryFiles.filter(img => 
                            img.name.toLowerCase().includes(meta.name.toLowerCase()) &&
                            (img.name.endsWith('.png') || img.name.endsWith('.jpg') || img.name.endsWith('.jpeg') || img.name.endsWith('.mp4'))
                        ).map(img => ({
                            name: img.name,
                            url: img.download_url || `https://raw.githubusercontent.com/${owner}/${repo}/${REPO_CONFIG.branch}/gallery/${encodeURIComponent(img.name)}`,
                            type: img.name.endsWith('.mp4') ? 'video' : 'image'
                        }));

                        return { 
                            rawName: file.name, 
                            name: meta.name, 
                            version: meta.version, 
                            desc: meta.desc, 
                            author: meta.author,
                            examples: examples // æ³¨å…¥ç¤ºä¾‹
                        };
                    });

                applySort();
                loadingState.style.display = 'none'; dataTable.style.display = 'table';
            } catch (error) {
                loadingState.innerHTML = `<span style="color:red">âš ï¸ åŠ è½½å¤±è´¥: ${error.message}</span>`;
            }
        }

        function parseFilename(filename) {
            const cleanName = filename.replace(/\.(md|txt)$/, '');
            const parts = cleanName.split(/[_-]/);
            const ver = parts.find(p => /^v\d/.test(p.toLowerCase())) || '-';
            let desc = "AI æç¤ºè¯";
            if(parts.length > 1) {
                const potentialDesc = parts.filter(p => p !== parts[0] && p !== ver);
                if(potentialDesc.length > 0) desc = potentialDesc.join(' ');
            }
            return { name: cleanName, version: ver, desc: desc, author: 'Kaylerris' };
        }

        // === 3. æ’åºä¸æ¸²æŸ“ (å«ç¤ºä¾‹åˆ—) ===
        function sortTable(key) {
            if (currentSort.key === key) currentSort.order = currentSort.order === 'asc' ? 'desc' : 'asc';
            else { currentSort.key = key; currentSort.order = 'asc'; }
            applySort();
        }

        function applySort() {
            document.querySelectorAll('th.sortable').forEach(th => {
                th.classList.remove('asc', 'desc');
                if (th.dataset.key === currentSort.key) th.classList.add(currentSort.order);
            });
            globalFilesData.sort((a, b) => {
                let valA = a[currentSort.key].toLowerCase();
                let valB = b[currentSort.key].toLowerCase();
                if (valA < valB) return currentSort.order === 'asc' ? -1 : 1;
                if (valA > valB) return currentSort.order === 'asc' ? 1 : -1;
                return 0;
            });
            renderTable();
        }

        function renderTable() {
            tableBody.innerHTML = '';
            globalFilesData.forEach(item => {
                // ç”Ÿæˆç¤ºä¾‹ HTML
                let examplesHtml = '<span style="color:#ccc">-</span>';
                if (item.examples.length > 0) {
                    examplesHtml = item.examples.slice(0, 3).map((ex, idx) => 
                        `<a class="example-tag" onclick="openLightbox('${ex.url}', '${ex.type}', '${ex.name}')">
                            ${ex.type === 'video' ? 'ğŸ¬' : 'ğŸ–¼ï¸'} ç¤ºä¾‹${idx + 1}
                        </a>`
                    ).join('');
                }

                const html = `
                    <tr>
                        <td><a class="prompt-link" onclick="viewFile('${item.rawName}', '${item.name}', '${item.author}')">${item.name}</a></td>
                        <td><span class="badge ${item.version.includes('v') ? 'v-new' : ''}">${item.version}</span></td>
                        <td class="hide-mobile">${item.desc}</td>
                        <td class="hide-mobile">${examplesHtml}</td>
                        <td class="hide-mobile">${item.author}</td>
                    </tr>`;
                tableBody.insertAdjacentHTML('beforeend', html);
            });
        }

        // === 4. é¢„è§ˆä¸å¯¼å…¥ ===
        function viewFile(fileName, displayName, author) {
            document.getElementById('modalTitle').innerText = `${displayName} by ${author}`;
            fileContent.innerText = "â³ è¯»å–ä¸­...";
            currentFileData = { name: '', content: '' };
            modal.classList.add('active');
            
            const hasToken = localStorage.getItem('gh_token');
            if (hasToken) {
                btnImport.style.display = 'inline-flex';
                btnImport.disabled = true; 
                btnImport.style.opacity = "0.5";
            } else {
                btnImport.style.display = 'none';
            }

            const owner = localStorage.getItem('gh_owner') || REPO_CONFIG.owner;
            const repo = localStorage.getItem('gh_repo') || REPO_CONFIG.repo;
            const rawUrl = `https://raw.githubusercontent.com/${owner}/${repo}/${REPO_CONFIG.branch}/${REPO_CONFIG.path}/${encodeURIComponent(fileName)}`;
            
            const onSuccess = (text) => {
                fileContent.innerText = text;
                currentFileData = { name: fileName, content: text };
                if(hasToken) { btnImport.disabled = false; btnImport.style.opacity = "1"; }
            };

            fetch(rawUrl).then(r => {
                if(!r.ok) throw new Error("Raw Error"); return r.text();
            }).then(onSuccess).catch(() => {
                fetch('prompt/' + fileName).then(r => r.text()).then(onSuccess).catch(() => {
                    fileContent.innerText = "âŒ è¯»å–å¤±è´¥\nè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ– GitHub Token é…ç½®ã€‚";
                });
            });
        }

        function importToEditor() {
            if (!currentFileData.content) { alert("æ•°æ®å°šæœªåŠ è½½ï¼Œè¯·ç¨å€™..."); return; }
            localStorage.setItem('kayler_editor_cache', currentFileData.content);
            localStorage.setItem('kayler_editor_filename', currentFileData.name);
            if(confirm(`ç¡®è®¤å¯¼å…¥ "${currentFileData.name}" åˆ°ç¼–è¾‘å™¨ï¼Ÿ`)) {
                window.location.href = 'editor.html';
            }
        }

        // === 5. ç¯ç®±é€»è¾‘ (æ–°åŠŸèƒ½) ===
        function openLightbox(url, type, caption) {
            const lightbox = document.getElementById('lightboxModal');
            const img = document.getElementById('lightboxContent');
            const video = document.getElementById('lightboxVideo');
            const cap = document.getElementById('lightboxCaption');
            
            cap.innerText = caption;
            lightbox.classList.add('active');
            
            if (type === 'video') {
                img.style.display = 'none';
                video.style.display = 'block';
                video.src = url;
                video.play();
            } else {
                video.style.display = 'none';
                video.pause();
                img.style.display = 'block';
                img.src = url;
            }
        }

        function closeLightbox() {
            document.getElementById('lightboxModal').classList.remove('active');
            document.getElementById('lightboxVideo').pause();
        }

        function closeModal() { modal.classList.remove('active'); }
        function copyContent() { navigator.clipboard.writeText(fileContent.innerText).then(() => alert('å·²å¤åˆ¶')); }

        fetchRepoData();
    </script>
</body>
</html>